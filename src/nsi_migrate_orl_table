#!/bin/bash

Usage()
{
  echo "Usage: $0 --testrun <Testrun Number>"
  echo "Example:"
  echo "  $0 --testrun 1234"
  exit -1
}
chk_args_of_option()
{
    if [ "X$1" == "X" ];then
    echo "Option $1 required a value."
    Usage
  fi
}

read_conf_file()
{

 CSV_CONF_FILE_PATH="$NS_WDIR/etc/dbconf/ns_db_csv.conf"

 if [ ! -f "$CSV_CONF_FILE_PATH" ]; then
    echo "Error: $CSV_CONF_FILE_PATH file is not present."
  else
    NS_TABLE_NAMES=(`cat $CSV_CONF_FILE_PATH | egrep -v "^ *#|^ *$" | awk -F'|' '{if($2 == 3) print $4}'`)
#Get total number of tables in fill
    NS_TOTAL_ENTRIES="${#NS_TABLE_NAMES[@]}"
    for((i=0;i<$NS_TOTAL_ENTRIES;i++))
    {
      psql test cavisson 2>&1 <<+
        alter table ${NS_TABLE_NAMES[i]}_$TRNUM add column StartTime bigint;
        alter table ${NS_TABLE_NAMES[i]}_$TRNUM add column EndTime bigint;
+
    }
  fi
}

#######################################################
#Read arguments
if [ "$1" != "" ];then
  case $1 in
    "--testrun")
        chk_args_of_option $2
        TRNUM=$2;;
  esac
  if [ -d "/home/cavisson/work/logs/TR$TRNUM" ]
  then
    read_conf_file
  else
    echo "please enter valid Test Run number"
  fi
fi
