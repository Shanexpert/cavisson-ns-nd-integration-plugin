#
# Name     : nsi_set_test_name
# Author   : Neeraj Jain
# Purpsose : To set test name of a test run
#
# Ouput    : None
#
# Arguments:  TestRun  and Test Name
#
# Modification History:
#   04/05/05: Neeraj - Initial Version
#   07/05/05: Neeraj - Add mv to move file  generated by awk
#   17/07/12: Prachi - Uses sed to rename Test Name in summary.data instead of grep


#!/bin/sh
if [ $# -lt 2 ];then
	echo "Usage: nsi_set_test_name TestRunNumber Test Description"
	exit 1
fi

if [ "X$NS_WDIR" = "X" ];then
	echo "NS_WDIR env var must be defined"
	exit 1
fi

TRNum=$1
shift
export TestName=$*

#echo  "`date` nsi_set_test_name $TRNum $TestName called" >> /tmp/nsi_set_test_name

#echo "Test Name is $TestName"

NSLogsPath=$NS_WDIR/logs
TRNumDir=TR$TRNum
TempFile=/tmp/nsi_set_test_name$$
cd $NSLogsPath

if [ -f $TRNumDir/summary.top ]
then
 cat $TRNumDir/summary.top | awk -F\| '{ printf "%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s\n", $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, ENVIRON["TestName"], $14, $15, $16 }' > $TempFile
 cp $TempFile $TRNumDir/summary.top
fi
rm -f $TempFile

if [ -f $TRNumDir/summary.data ]
then
# cat $TRNumDir/summary.data | awk -F\| '{ printf "%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s|%s\n", $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, ENVIRON["TestName"] }' > $TempFile
  #grep -v '10|Identity|10|Test Description' $TRNumDir/summary.data > $TempFile
  #echo "10|Identity|10|Test Description|$TestName" >> $TempFile
  #cp $TempFile $TRNumDir/summary.data  

  #Above code renames Test Name in line "10|Identity|10|Test Description|Test Name" in file summary.data, and then append it at the end of the file i.e. position of line(10|Identity|10|Test Description|Test Name) gets changed
  #Below code will rename Test Name in line "10|Identity|10|Test Description|Test Name" in file summary.data without changing its position 

  sed "2c\10|Identity|10|Test Description|$TestName" $TRNumDir/summary.data > $TempFile
  cp $TempFile $TRNumDir/summary.data
fi

rm -f $TempFile
exit 0
