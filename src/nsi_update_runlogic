# Name      : nsi_update_runlogic
# Author    : Atul
# Purpsose  : To update .runlogic.c file on split and merge page. This is called intereanlly
#
# Usage     :  nsi_update_runlogic <projectName> <subProjectName> <scriptName> <groupName> <operation> <currentIndex> <user_name> <profile_name>
#
# Modification History:
#   01/06/10: Atul - Initial Version
#   03/03/21:Anup - Support new dir struct $NS_WDIR/workspace/<user_name>/<profile_name>/cavisson/<proj>/<sub_proj>/scripts
#!/bin/sh

#Check and get login user name
PROJECT=$1
SUB_PROJECT=$2
SCRIPT_NAME=$3
USER_NAME=admin
PROFILE_NAME=default
if [ "X$7" != "X" ];then
 USER_NAME=$7
fi

if [ "X$8" != "X" ];then
 PROFILE_NAME=$7
fi
NS_TA_DIR=workspace/$USER_NAME/$PROFILE_NAME/cavisson

if [ ! -f $NS_WDIR/$NS_TA_DIR/$PROJECT/$SUB_PROJECT/scripts/$SCRIPT_NAME/.runlogic.c ]
then
  echo "runlogic file not exist for the script '"$PROJECT/$SUB_PROJECT/$SCRIPT_NAME"'"
  exit 0
fi

PAGE_NAMES=`nsu_get_page $NS_TA_DIR/$PROJECT/$SUB_PROJECT/$SCRIPT_NAME`
USER_NAME=`whoami 2>/dev/null`
if [ $? != 0 ];then
  echo "Error: Unable to get the real user name"
  exit 1
fi
GROUP_NAME=$4
OPERATION=$5
INDEX=$6
PAGE_NAMES=`echo ${PAGE_NAMES} | sed 's/ /,/g'`

java -cp $NS_WDIR/webapps/netstorm/WEB-INF/lib/netstorm_bean.jar:$NS_WDIR/webapps/netstorm/lib/netstorm_servletClient.jar:$NS_WDIR/webapps/netstorm/lib/runlogic.jar:/apps/java/jdk1.7.0_71/sample/jnlp/servlet/jnlp.jar -DNS_WDIR=$NS_WDIR pacRunlogic.RunLogic $NS_TA_DIR"/"$PROJECT"/"$SUB_PROJECT"/scripts/"$SCRIPT_NAME $PAGE_NAMES $USER_NAME $GROUP_NAME $OPERATION $INDEX
exit $?

