# Name      : nsi_merge_sort_scen
# Author    : Atul
# Purpsose  : To merge and sort given scenario file as per $NS_WDIR/etc/KeywordDefinition.dat file
#             used by netstorm.
#
# Usage     :  nsi_merge_sort_scen <MergeAndSort/Sort> <Source scenario name> -d <Destination scenario #              file name>
# Here new page name is optional but if it is given then it must be given for all pages
#
#!/bin/sh
#Check and get login user name
#Option - 0  =>MergeAndSort
#Option - 1  =>Sort

usage()
{
  echo "$0 <option[0/1]> <src scenario file> <dest scenario file>"
  exit 1
}

if [ $# != 3 ];then
  usage
fi


OPTION="$1"
SCENARIO_FILE="$2"
SORTED_SCENARIO="$3"
TEMP_FILE="/tmp/merged_scenario.$$"

USER_NAME=`whoami 2>/dev/null`
if [ $? != 0 ];then
  echo "Error: Unable to get the real user name"
  exit 1
fi


rm -f $SORTED_SCENARIO

if [ $OPTION == 0 ];then
   OPTION="MergeAndSort"
elif [ $OPTION == 1 ];then
   OPTION="Sort"
else
   usage
fi 

if [ ! -f $SCENARIO_FILE ];then
  echo $SCENARIO_FILE does not exist.
  exit -1
fi

#cd $NS_WDIR/webapps/netstorm/WEB-INF/classes
#java -cp $NS_WDIR/webapps/netstorm/WEB-INF/lib/netstorm_bean.jar -DNS_WDIR=$NS_WDIR pac1.Bean.MergeSortScen $0  $NS_WDIR/scenarios/$1 $2

java -cp $NS_WDIR/webapps/netstorm/WEB-INF/lib/netstorm_bean.jar -DNS_WDIR=$NS_WDIR pac1.Bean.MergeSortScen $OPTION $SCENARIO_FILE $TEMP_FILE $USER_NAME
if [ $? != 0 ];then
  echo "Unable to merge $SCENARIO_FILE"
  exit 1
fi 


sort -n $TEMP_FILE | awk -F'|' '{print $2}' >$SORTED_SCENARIO
if [ $? != 0 ];then
  echo "Unable to sort $SCENARIO_FILE"
  exit 1
fi 

#rm -f $TEMP_FILE

exit 0
